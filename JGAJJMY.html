<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Scanne den QR-Code</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      margin-bottom: 10px;
    }
    #puzzle {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 5px;
      margin: 20px auto;
      width: 320px;
    }
	.tile {
	  width: 100px;
	  height: 100px;
	  position: relative;
	  font-size: 1.8em;
	  font-weight: bold;
	  color: black;
	  -webkit-text-stroke: 1.5px white;
	  display: flex;
	  justify-content: center;
	  align-items: center;
	  cursor: pointer;
	  border-radius: 5px;
	  background-repeat: no-repeat;
	  background-size: 300px 300px;
	}
	.empty {
	  background: #ccc;
	  cursor: default;
	}
  </style>
</head>
<body>
  <h1>Scanne den QR-Code</h1>
  <div id="puzzle"></div>
  <div id="complete-image" style="display: none; margin-top: 20px;">
    <img src="puzzlebild.jpg" alt="Puzzle gelöst!" width="300" height="300" style="border: 2px solid #444; border-radius: 5px;">
  </div>
  <script>
    const size = 3;
    let tiles = Array.from({ length: size * size }, (v, i) => i);
    
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    
    function isSolvable(arr) {
      let inversions = 0;
      let flatArr = arr.filter(num => num !== 0);
      for (let i = 0; i < flatArr.length; i++) {
        for (let j = i + 1; j < flatArr.length; j++) {
          if (flatArr[i] > flatArr[j]) inversions++;
        }
      }
      return inversions % 2 === 0;
    }
    
    function isSolved() {
      for (let i = 0; i < tiles.length - 1; i++) {
        if (tiles[i] !== i + 1) return false;
      }
      return tiles[tiles.length - 1] === 0;
    }
    
    do {
      shuffle(tiles);
    } while (!isSolvable(tiles) || isSolved());

    const puzzleDiv = document.getElementById("puzzle");

    function render() {
      puzzleDiv.innerHTML = "";
      tiles.forEach((tile, index) => {
      const tileDiv = document.createElement("div");
      tileDiv.classList.add("tile");
      tileDiv.setAttribute("data-index", index);
      if (tile === 0) {
        tileDiv.classList.add("empty");
        tileDiv.style.backgroundImage = "none";
        tileDiv.innerText = "";
      } else {
        const row = Math.floor((tile - 1) / size);
        const col = (tile - 1) % size;
        tileDiv.style.backgroundImage = "url('puzzlebild.jpg')";
        tileDiv.style.backgroundSize = `${size * 100}px ${size * 100}px`;
        tileDiv.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
        tileDiv.innerText = tile;
      }
      puzzleDiv.appendChild(tileDiv);
      });
    }
    
    function indexToPos(index) {
      return { row: Math.floor(index / size), col: index % size };
    }

    function swap(i, j) {
      [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
    }

    puzzleDiv.addEventListener("click", function(e) {
      if (!e.target.classList.contains("tile")) return;
      const clickedIndex = parseInt(e.target.getAttribute("data-index"));
      const emptyIndex = tiles.indexOf(0);
      const clickedPos = indexToPos(clickedIndex);
      const emptyPos = indexToPos(emptyIndex);
      if (
        (clickedPos.row === emptyPos.row && Math.abs(clickedPos.col - emptyPos.col) === 1) ||
        (clickedPos.col === emptyPos.col && Math.abs(clickedPos.row - emptyPos.row) === 1)
      ) {
        swap(clickedIndex, emptyIndex);
        render();
        if (isSolved()) {
          setTimeout(() => {
            alert("Glückwunsch, du hast das Puzzle gelöst!");
            document.getElementById("complete-image").style.display = "block";
          }, 100);
        }

      }
    });
    render();
  </script>
</body>
</html>
